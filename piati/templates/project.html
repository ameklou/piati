{% set active_page='project'%}
{% set title = project.name %}
{% extends "layout.html" %}
{% block content %}

<div class="row">
  <h1>{{ project.name }}</h1>
  {% if project.description %}
    <p class="lead">{{ project.description }}</p>
  {% endif %}
</div>
<div class="row wrapper">
  <div class="col third">
      <b>{% trans %}Project ID{% endtrans %}</b>: {{ project.id }}<br />
      <b>{% trans %}Last updated time{% endtrans %}</b>: {{ project.last_updated }}
      {% if project.status %}
        <div><b>{% trans %}Current status{% endtrans %}</b>: {{ project.status }}</div>
      {% endif %}
      {% if project.topics %}
        <div>{% trans %}Topics{% endtrans %}: {% for topic in project.topics %} <a class="tag" href="{{ url_for('show_projects') }}#?topic={{ topic }}">{{ topic }}</a>{% endfor %}</div>
      {% endif %}
      <hr />
      <table>
        <caption>{% trans %}Organisations{% endtrans %}</caption>
        <thead>
          <th>{% trans %}Name{% endtrans %}</th>
          <th>{% trans %}Role{% endtrans %}</th>
        </thead>
        {% for org in project.participating_org + [project.reporting_org] %}
          <tr class="{{ loop.cycle('odd', 'even') }}"><td><a href="{{ url_for('show_projects') }}#?orgs={{ org.name }}">{{ org.name }}</a></td><td>{{ org.role }}</td></tr>
        {% endfor %}
      </table>
    <hr />
    <table class="table table-condensed">
      <caption>{% trans %}Dates{% endtrans %}</caption>
      <thead>
        <th>{% trans %}Type{% endtrans %}</th>
        <th>{% trans %}Date{% endtrans %}</th>
      </thead>
      {% for date in project.dates %}
        <tr class="{{ loop.cycle('odd', 'even') }}"><td>{{ date.label }}</td><td>{{ date.value|default('—', true) }}</td></tr>
      {% endfor %}
    </table>
  </div>
  <div class="col two-third">
      <nav class="tabs"><!--
        --><a href="#tab-map" class="on">{% trans %}Map{% endtrans %}</a><!--
        --><a href="#tab-data">{% trans %}Overview{% endtrans %}</a><!--
        --><a href="#tab-financial">{% trans %}Financial data{% endtrans %}</a><!--
    --></nav>
      <div id="tab-map" class="map tab-content on"></div>

      <div id="tab-data" class="tab-content">
        {% if project.sectors %}
        <table>
          <caption>{% trans %}Sectors{% endtrans %}</caption>
          <thead>
            <th>{% trans %}Name{% endtrans %}</th>
            <th>{% trans %}Percent{% endtrans %}</th>
            <th>{% trans %}Type{% endtrans %}</th>
          </thead>
          {% for sector in project.sectors %}
            <tr class="{{ loop.cycle('odd', 'even') }}"><td><a href="{{ url_for('show_projects') }}#?sectors={{ sector.name }}">{{ sector.name }}</a></td>
                <td>{{ sector.percentage|default('—', true) }}</td>
                <td>{{ sector.vocabulary|default('—', true) }}</td></tr>
          {% endfor %}
        </table>
        {% endif %}
    {% if project.results %}
      {% for result in project.results%}
      <hr />
      <table>
        <caption>{{ result.label }}</caption>
        <thead>
          <th>{% trans %}Indicator{% endtrans %}</th>
          <th>{% trans %}Start{% endtrans %}</th>
          <th>{% trans %}End{% endtrans %}</th>
        </thead>
        {% for indicator in result.indicators %}
          <tr class="{{ loop.cycle('odd', 'even') }}">
            <td>{{ indicator.label }}</td>
            <td>{{ indicator.start }}</td>
            <td>{{ indicator.end }}</td></tr>
        {% endfor %}
      </table>
      {% endfor %}
    {% endif %}
      </div>
      <div id="tab-financial" class="tab-content">
        <table class="table table-condensed">
          <caption>{% trans %}Financial data{% endtrans %}</caption>
          <thead>
            <th>{% trans %}Type{% endtrans %}</th>
            <th>{% trans %}Date{% endtrans %}</th>
            <th>{% trans %}Value{% endtrans %}</th>
          </thead>
          <tbody>
          {% for transaction in project.transactions %}
            <tr class="{{ loop.cycle('odd', 'even') }}">
              <td>{{ transaction.type }}</td>
              <td>{{ transaction.date }}</td>
              <td>{{ transaction.value }} {{ transaction.currency }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>    
      </div>
  </div>
</div>

<script type="text/javascript">
  var mapHandler = new PiatiMap('tab-map', [{{ project|piati_tojson }}]),
      tabsHandler = new PiatiTabs();
</script>

{% endblock %}
